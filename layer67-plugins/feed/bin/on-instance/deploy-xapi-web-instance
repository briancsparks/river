#!/bin/bash -e

eval "$(cli-shezargs $@)"

# Get the port we should listen on
port="$(egrep '#.*CONFIG_JSON' /etc/nginx/sites-enabled/rriver.mobilewebassist.net.conf | sed 's/^[^{[]*//g' | jq -r '.routerPort')"

# Start layer67 xapi server
cd ~/dev/layer67/layer67-plugins/xapi && pm2 start xapi-router.js --name xapi -- --port=${port}

# Get our project
cd ~/dev && git clone https://github.com/briancsparks/river.git
cd river && npm install --production

# Get the feed server up and running
cd layer67-plugins/feed
pm2 start feed-router.js --name feed -- --port=3001

